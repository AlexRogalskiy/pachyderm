#!/bin/sh

# This script cleans up pachyderm state.
# If PACHYDERM_IMAGE is set, also docker kills and docker rms ${PACHYDERM_IMAGE}.
# Otherwise, docker kills and docker rms pachyderm.

set -E

DIR="$(cd "$(dirname "${0}")" && pwd)"

sudo umount "/tmp/pfs/btrfs" > /dev/null 2> /dev/null
sudo rm -rf "/tmp/pfs" > /dev/null 2< /dev/null
if [ -z "${NODOCKER}" ]; then
  if [ -z "${PACHYDERM_IMAGE}" ]; then
    PACHYDERM_IMAGE="pachyderm"
  fi
  docker kill "${PACHYDERM_IMAGE}" > /dev/null 2> /dev/null
  docker rm "${PACHYDERM_IMAGE}" > /dev/null 2> /dev/null
fi
exit 0
