#!/bin/sh

set -Ee

DIR="$(cd "$(dirname "${0}")/.." && pwd)"

mkdir -p "${DIR}/etc/deps"
go get -v github.com/peter-edge/go-tools/go-external-deps
${GOPATH}/bin/go-external-deps "github.com/pachyderm/pachyderm/..." | grep -v "^github.com/pachyderm/pachyderm" > "${DIR}/.deps.list.tmp"
if [ ! -f "${DIR}/etc/deps/deps.list" ] || [ -n "$(diff -u "${DIR}/.deps.list.tmp" "${DIR}/etc/deps/deps.list")" ]; then
  mv "${DIR}/.deps.list.tmp" "${DIR}/etc/deps/deps.list"
else
  rm "${DIR}/.deps.list.tmp"
fi
