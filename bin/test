#!/bin/sh

# This script will run go test for pachyderm, setting up btrfs first.
# Use this script wrapped in a bin/run command, or inside `make shell`.
# Set the variable KEEP_BTRFS to keep btrfs state around after the test.

set -Eex

DIR="$(cd "$(dirname "${0}")" && pwd)"

. "${DIR}/../etc/env/env.env"

if [ -z "${GOMAXPROCS}" ]; then
	GOMAXPROCS="${DEFAULT_GOMAXPROCS}"
fi

btrfs-mount-wrapper go test -parallel "${GOMAXPROCS}" -timeout "${GO_TEST_TIMEOUT}" $@
