syntax = "proto3";

import "google/protobuf/empty.proto";

package pps;

message Node {
  map<string, string> input = 1;
  map<string, string> output = 2;
  repeated string run = 3;
}

message DockerService {
  string image = 1;
  string build = 2;
  string dockerfile = 3;
}

message Element {
  string name = 1;
  string path = 2;
  oneof typed_element {
    Node node = 3;
    DockerService docker_service = 4;
  }
}

message Pipeline {
  map<string, Element> name_to_element = 1;
}

message GithubPipelineSource {
  string user = 1;
  string repository = 2;
  string branch = 3;
  string access_token = 4;
}

message PipelineSource {
  oneof typed_pipeline_source {
    GithubPipelineSource github_pipeline_source = 1;
  }
}

message Version {
  uint32 major = 1;
  uint32 minor = 2;
  uint32 micro = 3;
  string additional = 4;
}

message GetVersionResponse {
  Version version = 1;
}

message GetPipelineRequest {
  PipelineSource pipeline_source = 1;
}

message GetPipelineResponse {
  Pipeline pipeline = 1;
}

service Api {
  rpc GetVersion(google.protobuf.Empty) returns (GetVersionResponse) {}
  rpc GetPipeline(GetPipelineRequest) returns (GetPipelineResponse) {} 
}
