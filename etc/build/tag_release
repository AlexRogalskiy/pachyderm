#!/bin/sh

if [ -z "$TRAVIS_BUILD_NUMBER" ]; then
	echo "Only travis can tag a release"
	exit 1
fi

echo "Travis build number: ${TRAVIS_BUILD_NUMBER}"
echo "Version prefix:"
export VERSION_PREFIX=`make version-prefix`
echo $VERSION_PREFIX
echo "Doing the tagging..."
git tag "$VERSION_PREFIX.$TRAVIS_BUILD_NUMBER"
echo "Listing tags ..."
git tag
echo "Pushing tags ..."
git push --quiet https://${GITHUB_RELEASE_TOKEN}@github.com/pachyderm/pachyderm --tags > /dev/null 2>&1
