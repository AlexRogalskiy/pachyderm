#!/bin/bash

version=`cat VERSION`

if [ -z $version ]
then
        echo "No version found for this commit! Aborting release"
        exit 1
fi

echo "--- Releasing pachd w version: $version"

build_number=`echo $version | sed -En 's/(v[0-9]+\.[0-9]+\.[0-9]+)\((.*)\)/\2/p'`
docker_version=`echo $version | sed -e 's/[\(]/-/g' | sed -e 's/[\)]//g'`

TRAVIS_BUILD_NUMBER=$build_number make docker-push-pachd
docker version pachyderm/pachd:latest pachyderm/pachd:$docker_version
docker push pachyderm/pachd:$docker_version
